# ポケカ PSA10 買取比較アプリ — Web版リビルド 概要・指示書

## 1. 概要

### 1.1 プロジェクトの目的
ポケモンカード（PSA10）の**買取価格（おたちゅう）**と**販売価格（カードラッシュ）**を比較し、利益の出る商品を一覧で確認するためのWebアプリである。

### 1.2 現状
- **技術**: Streamlit（Python）単体
- **データ**: `merged_card_data.csv`（おたちゅう買取データ + ラッシュ販売・在庫・画像URL 等をマージしたCSV）
- **課題**: ページネーション下部押下時の「トップへスクロール」が Streamlit の制約で 2 回目以降効かない等、UI の細かい制御が難しい

### 1.3 ゴール
Streamlit をやめ、**通常の Web アプリ**として再構築する。  
スクロール・ページ切り替え・フィルターをクライアント側で確実に制御し、デプロイ・保守しやすい構成にする。

### 1.4 推奨技術スタック
- **フロント**: Vite + React
- **バックエンド**: FastAPI（Python）
- **データ**: 既存の `merged_card_data.csv` を API 経由で提供（またはビルド時に JSON 化して静的配信も可）

---

## 2. データ仕様

### 2.1 CSV カラム（`merged_card_data.csv`）
| カラム名 | 説明 |
|----------|------|
| No | カード番号（例: 766/742） |
| レア | レアリティ |
| カード名 | カード名 |
| card_number | 型番 |
| 買取金額 | おたちゅうの買取価格（円） |
| 更新日 | 買取データの更新日 |
| 弾 | 弾名 |
| ラッシュ販売価格 | カードラッシュの販売価格（円） |
| ラッシュ在庫状況 | 例: 「在庫あり (1枚)」「在庫なし」「取得失敗」 |
| 画像URL | カード画像のURL |
| 期待利益 | 既存計算値（任意。API側で再計算してもよい） |

### 2.2 利益計算ルール（既存ロジックを踏襲）
- **予想最大利益** = 買取金額 − ラッシュ販売価格
- 在庫なし・取得失敗の場合は原則 **0 円**（販売価格が取れている場合は計算する）
- CSV に「期待利益」がある場合はそれを利用してよい
- マイナス利益もそのまま表示する

### 2.3 在庫状況の正規化
- `取得失敗`・空・NaN → 「在庫なし」として扱う
- それ以外はラッシュ在庫状況の文字列をそのまま表示してよい

---

## 3. 機能要件（実装すべきこと）

### 3.1 共通
- **ヘッダー**: タイトル「🃏 ポケモンカード PSA10 買取比較」、キャプション「おたちゅう（買取）vs カードラッシュ（販売）の価格比較」
- **フィルター**
  - キーワード検索: カード名・型番（card_number）・No で部分一致（大文字小文字区別なし）
  - チェック「在庫ありのみ表示」: ラッシュ在庫状況が「在庫あり」を含むものだけ表示
  - チェック「利益が出る商品のみ表示」: 予想最大利益 > 0 のものだけ表示
- **統計表示**: 全データ数・表示中件数・利益が出る商品数・在庫ありの商品数（フィルター結果に応じて更新）

### 3.2 表示モード（2タブまたは2セクションで切り替え）
1. **データ分析（PC向け）**
   - ソート可能なテーブル: カード名・型番・買取価格・販売価格・予想最大利益・在庫状況・画像
   - 利益はプラスは🟢/緑、マイナスは🔴/赤で表示
   - テーブル下に「予想最大利益の平均・最大・最小」を表示
   - 同じデータの**カード一覧**も表示（現場リサーチと同じカード型UI）
2. **現場リサーチ（スマホ向け）**
   - カード型リストのみ（画像・カード名・型番・予想最大利益・買取価格・販売価格・在庫）

### 3.3 カード一覧の仕様
- 1カードあたり: 画像（または画像なし表示）・カード名・型番・**予想最大利益（大きく・プラスは緑・マイナスは赤）**・買取価格（おたちゅう）・販売価格（ラッシュ）・在庫状況
- 予想最大利益の降順でソート
- **ページネーション**
  - 1ページあたり 10 件（変更可能にするかは任意）
  - 「◀◀ 10前」「◀ 前へ」「ページ N / M（件数表示）」「次へ ▶」「10後 ▶▶」
  - ページ番号の直接入力（1 〜 最大ページ）
  - **下部のページネーション操作時は、必ずページ先頭へスクロールする**（通常の Web なので `scrollTo(0,0)` や `scrollIntoView` で実装すること）

### 3.4 UI・デザイン
- 既存のテーマカラーを再現することを推奨:
  - 背景: `#f8fafc`（メイン）、`#f1f5f9`（サイドバー）
  - アクセント: `#2563eb`、薄い青 `#dbeafe`
  - 利益プラス: `#059669`、マイナス: `#dc2626`
  - テキスト: `#1e293b`、補助: `#64748b`
- カード風のボックス・角丸・軽いシャドウでセクションを区切る
- **レスポンシブ**: 768px 以下でスマホ向けレイアウト（フィルターをメインに表示、コンパクトなカード・ページネーション）

---

## 4. 非機能・技術的な指示

### 4.1 バックエンド（FastAPI）
- CSV を読み込み、フィルター（キーワード・在庫あり・利益あり）は **API で行うか、全件返してフロントで行うか** はどちらでもよい（データ量が多くなければ全件 JSON 返却で可）
- 利益・在庫正規化は既存の `app.py` の `calculate_profit`・`normalize_stock_status`・`filter_data` のロジックを移植すること
- CORS を有効にし、フロントのオリジンからアクセスできるようにする

### 4.2 フロント（Vite + React）
- フィルター変更時に表示データを更新し、ページネーションは 1 にリセットする
- ページ切り替え時（特に下部ボタン・入力で変更したとき）は **必ずページ先頭へスクロール** すること（Streamlit のような制約はないので確実に実装すること）
- 画像 URL は外部サイトなので、`<img src={url} />` で表示し、エラー時は「画像なし」等のフォールバックを表示すること

### 4.3 デプロイ
- フロント: 静的ビルド（`npm run build`）を Vercel / Netlify / GitHub Pages 等に配置
- API: `merged_card_data.csv` を読める場所に配置し、FastAPI を Railway / Render / 自前サーバー等で起動
- 本番では API の URL を環境変数等で切り替えられるようにすること

---

## 5. 受け入れ基準（完了の目安）

- [ ] ヘッダー・フィルター・統計が現行と同等に動作する
- [ ] データ分析タブでテーブル＋カード一覧が表示され、テーブルはソート可能である
- [ ] 現場リサーチタブでカード一覧＋ページネーションが動作する
- [ ] 下部のページネーション（前へ・次へ・10前・10後・ページ番号入力）でページを変えたとき、**毎回ページ先頭へスクロールする**
- [ ] 768px 以下でスマホ向けレイアウトになり、操作しやすいこと
- [ ] 既存 CSV をそのまま読み込んで、利益・在庫表示が現行 app.py と整合していること

---

## 6. 参照ファイル

- 既存アプリ: `app.py`
- データ: `merged_card_data.csv`
- スクロール問題の整理: `scroll_to_top_issue_summary.md`

---

このドキュメントを「概要・指示書」として、AI や開発者に渡して Web 版リビルドの実装を依頼してください。
