# filtered_cards.csv 概要（Gemini 相談用）

## 元データと出力の関係

| ファイル | 件数 | 説明 |
|----------|------|------|
| **merged_card_data.csv** | 420件 | おたちゅう（買取）とカードラッシュ（販売）を突き合わせた全カード |
| **filtered_cards.csv** | 126件 | 上記からフィルタした「仕入れ候補」のみ |

---

## 何が違うか

### 1. 列の違い

**merged_card_data.csv の列:**
- No, レア, カード名, card_number, 買取金額, 更新日, 弾, ラッシュ販売価格, ラッシュ在庫状況, 画像URL, 期待利益

**filtered_cards.csv の追加列:**
- **鑑定費** … PSA鑑定にかかる費用（3,000円 or 10,000円）
- **手取り利益** … 期待利益 − 鑑定費
- **利益率** … 手取り利益 ÷ (仕入れ値 + 鑑定費) × 100（%）
- **月換算利益率** … 3,000円プランの場合のみ、利益率 ÷ 2（2ヶ月拘束を想定）

### 2. 行の違い（絞り込み）

- 元: 420件すべて
- 出力: 126件（フィルタ条件を満たすカードのみ）

---

## 絞り込みロジック

### ステップ1: 予想最大利益の計算（バックエンドAPIと同一ロジック）

- **在庫なし**: 期待利益は使わず `買取金額 − ラッシュ販売価格` で計算
- **在庫あり**: 期待利益があればそれを使用、なければ買取金額 − ラッシュ販売価格

### ステップ2: 予想最大利益 10,001円未満を除外

- 10,000円以下は鑑定費を引くと割に合わないため対象外
- これで 420件 → 約290件程度に減る

### ステップ3: 鑑定費の決定（予想最大利益に応じて）

- **10,001円〜29,999円** → 鑑定費 3,000円（標準・2〜3ヶ月）
- **30,000円以上** → 鑑定費 10,000円（快速・約1ヶ月）

### ステップ4: 利益率の計算

```
利益率 = 手取り利益 ÷ (仕入れ値 + 鑑定費) × 100
手取り利益 = 予想最大利益 − 鑑定費
仕入れ値 = ラッシュ販売価格（素体の購入価格）
```

### ステップ5: 利益率20%未満を除外

- デフォルトで「利益率20%以上」のみを仕入れ候補として残す
- 丸めずに比較（例: 19.999...% は除外、20.0% は含める）

---

## 実行順序

```
scrape_otachu.py → scrape_rush.py → generate_filtered_csv.py
```

`merged_card_data.csv` が更新された後に `generate_filtered_csv.py` を実行し、`filtered_cards.csv` を生成する。

---

## 出力例

| No | カード名 | 買取金額 | ラッシュ販売価格 | 鑑定費 | 手取り利益 | 利益率 | 月換算利益率 |
|----|----------|----------|------------------|--------|------------|--------|--------------|
| 766/742 | メガリザードンYex | 600000 | 428000 | 10000 | 162000 | 37.0% | — |
| 765/742 | リーリエのピッピex | 100000 | 74800 | 3000 | 22200 | 28.5% | 14.3% |

※ 10,000円プラン（快速）の場合は月換算利益率は空欄

---

## 用途

- 仕入れ候補の一覧をスプレッドシートで確認・管理
- 利益率・鑑定費を考慮した取引判断の参考
- 他ツールや分析へのデータ渡し
